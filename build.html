<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Build system &mdash; Elemental 0.82-dev documentation</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.82-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="Elemental 0.82-dev documentation" href="index.html" />
    <link rel="next" title="Core functionality" href="core.html" />
    <link rel="prev" title="Introduction" href="intro.html" /> 
  </head>
  <body>
      <div class="header"><img class="rightlogo" src="_static/elemental-half.png" alt="Logo"/><h1 class="heading"><a href="index.html">
          <span>Elemental 0.82-dev documentation</span></a></h1>
        <h2 class="heading"><span>Build system</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="intro.html">Introduction</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="core.html">Core functionality</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="build-system">
<h1>Build system<a class="headerlink" href="#build-system" title="Permalink to this headline">¶</a></h1>
<p>Elemental&#8217;s build system relies on <a class="reference external" href="http://www.cmake.org">CMake</a>
in order to manage a large number of configuration options in a
platform-independent manner; it can be easily configured to build on Linux and
Unix environments (including Darwin) as well as various versions of
Microsoft Windows.</p>
<p>Elemental&#8217;s main dependencies are</p>
<ol class="arabic simple">
<li><a class="reference external" href="http://www.cmake.org/">CMake</a> (required)</li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Message_Passing_Interface">MPI</a> (required)</li>
<li><a class="reference external" href="http://netlib.org/blas">BLAS</a> and <a class="reference external" href="http://netlib.org/lapack">LAPACK</a> (required)</li>
<li><a class="reference external" href="http://code.google.com/p/pmrrr">PMRRR</a> (required for eigensolvers)</li>
<li><a class="reference external" href="http://www.cs.utexas.edu/users/flame/">libFLAME</a> (recommended for faster SVD&#8217;s)</li>
</ol>
<p>Each of these dependencies is discussed in detail below.</p>
<div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cmake">
<h3>CMake<a class="headerlink" href="#cmake" title="Permalink to this headline">¶</a></h3>
<p>Elemental uses several new CMake modules, so it is important to ensure that
version 2.8.5 or later is installed. Thankfully the
<a class="reference external" href="http://www.cmake.org/cmake/help/install.html">installation process</a>
is extremely straightforward: either download a platform-specific binary from
the <a class="reference external" href="http://www.cmake.org/cmake/resources/software.html">downloads page</a>,
or instead grab the most recent stable tarball and have CMake bootstrap itself.
In the simplest case, the bootstrap process is as simple as running the
following commands:</p>
<div class="highlight-python"><pre>./bootstrap
make
make install</pre>
</div>
<p>Note that recent versions of <a class="reference external" href="http://www.ubuntu.com/">Ubuntu</a> (e.g., version 12.04) have sufficiently up-to-date
versions of CMake, and so the following command is sufficient for installation:</p>
<div class="highlight-python"><pre>sudo apt-get install cmake</pre>
</div>
<p>If you do install from source, there are two important issues to consider</p>
<ol class="arabic">
<li><p class="first">By default, <tt class="docutils literal"><span class="pre">make</span> <span class="pre">install</span></tt> attempts a system-wide installation
(e.g., into <tt class="docutils literal"><span class="pre">/usr/bin</span></tt>) and will likely require administrative privileges.
A different installation folder may be specified with the <tt class="docutils literal"><span class="pre">--prefix</span></tt>
option to the <tt class="docutils literal"><span class="pre">bootstrap</span></tt> script, e.g.,:</p>
<div class="highlight-python"><pre>./bootstrap --prefix=/home/your_username
make
make install</pre>
</div>
<p>Afterwards, it is a good idea to make sure that the environment variable
<tt class="docutils literal"><span class="pre">PATH</span></tt> includes the <tt class="docutils literal"><span class="pre">bin</span></tt> subdirectory of the installation folder, e.g.,
<tt class="docutils literal"><span class="pre">/home/your_username/bin</span></tt>.</p>
</li>
<li><p class="first">Some highly optimizing compilers will not correctly build CMake, but the GNU
compilers nearly always work. You can specify which compilers to use by
setting the environment variables <tt class="docutils literal"><span class="pre">CC</span></tt> and <tt class="docutils literal"><span class="pre">CXX</span></tt> to the full paths to
your preferred C and C++ compilers before running the <tt class="docutils literal"><span class="pre">bootstrap</span></tt> script.</p>
</li>
</ol>
<div class="section" id="basic-usage">
<h4>Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h4>
<p>Though many configuration utilities, like
<a class="reference external" href="http://www.gnu.org/software/autoconf/">autoconf</a>, are designed such that
the user need only invoke <tt class="docutils literal"><span class="pre">./configure</span> <span class="pre">&amp;&amp;</span> <span class="pre">make</span> <span class="pre">&amp;&amp;</span> <span class="pre">make</span> <span class="pre">install</span></tt> from the
top-level source directory, CMake targets <em>out-of-source</em> builds, which is
to say that the build process occurs away from the source code. The
out-of-source build approach is ideal for projects that offer several
different build modes, as each version of the project can be built in a
separate folder.</p>
<p>A common approach is to create a folder named <tt class="docutils literal"><span class="pre">build</span></tt> in the top-level of
the source directory and to invoke CMake from within it:</p>
<div class="highlight-python"><pre>mkdir build
cd build
cmake ..</pre>
</div>
<p>The last line calls the command line version of CMake, <tt class="docutils literal"><span class="pre">cmake</span></tt>,
and tells it that it should look in the parent directory for the configuration
instructions, which should be in a file named <tt class="docutils literal"><span class="pre">CMakeLists.txt</span></tt>. Users that
would prefer a graphical interface from the terminal (through <tt class="docutils literal"><span class="pre">curses</span></tt>)
should instead use <tt class="docutils literal"><span class="pre">ccmake</span></tt> (on Unix platforms) or <tt class="docutils literal"><span class="pre">CMakeSetup</span></tt>
(on Windows platforms). In addition, a GUI version is available through
<tt class="docutils literal"><span class="pre">cmake-gui</span></tt>.</p>
<p>Though running <tt class="docutils literal"><span class="pre">make</span> <span class="pre">clean</span></tt> will remove all files generated from running
<tt class="docutils literal"><span class="pre">make</span></tt>, it will not remove configuration files. Thus, the best approach for
completely cleaning a build is to remove the entire build folder. On *nix
machines, this is most easily accomplished with:</p>
<div class="highlight-python"><pre>cd ..
rm -rf build</pre>
</div>
<p>This is a better habit than simply running <tt class="docutils literal"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">*</span></tt> since,
if accidentally run from the wrong directory, the former will most likely fail.</p>
</div>
</div>
<div class="section" id="id1">
<h3>MPI<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>An implementation of the Message Passing Interface (MPI) is required for
building Elemental. The two most commonly used implementations are</p>
<ol class="arabic simple">
<li><a class="reference external" href="http://www.mcs.anl.gov/research/projects/mpich2/">MPICH2</a></li>
<li><a class="reference external" href="http://www.open-mpi.org/">OpenMPI</a></li>
</ol>
<p>If your cluster uses <a class="reference external" href="http://en.wikipedia.org/wiki/InfiniBand">InfiniBand</a> as its interconnect, you may want to look into
<a class="reference external" href="http://mvapich.cse.ohio-state.edu/overview/mvapich2/">MVAPICH2</a>.</p>
<p>Each of the respective websites contains installation instructions, but, on recent versions of <a class="reference external" href="http://www.ubuntu.com/">Ubuntu</a> (such as version 12.04),
MPICH2 can be installed with</p>
<div class="highlight-python"><pre>sudo apt-get install libmpich2-dev</pre>
</div>
<p>and OpenMPI can be installed with</p>
<div class="highlight-python"><pre>sudo apt-get install libopenmpi-dev</pre>
</div>
</div>
<div class="section" id="blas-and-lapack">
<h3>BLAS and LAPACK<a class="headerlink" href="#blas-and-lapack" title="Permalink to this headline">¶</a></h3>
<p>The Basic Linear Algebra Subprograms (BLAS) and Linear Algebra PACKage (LAPACK)
are both used heavily within Elemental. On most installations of <a class="reference external" href="http://www.ubuntu.com">Ubuntu</a>, the following command should suffice for their installation:</p>
<div class="highlight-python"><pre>sudo apt-get install libatlas-dev liblapack-dev</pre>
</div>
<p>The reference implementation of LAPACK can be found at</p>
<blockquote>
<div><a class="reference external" href="http://www.netlib.org/lapack/">http://www.netlib.org/lapack/</a></div></blockquote>
<p>and the reference implementation of BLAS can be found at</p>
<blockquote>
<div><a class="reference external" href="http://www.netlib.org/blas/">http://www.netlib.org/blas/</a></div></blockquote>
<p>However, it is better to install an optimized version of these libraries,
especialy for the BLAS. The most commonly used open source versions are
<a class="reference external" href="http://math-atlas.sourceforge.net/">ATLAS</a> and <a class="reference external" href="https://github.com/xianyi/OpenBLAS">OpenBLAS</a>.</p>
</div>
<div class="section" id="id2">
<h3>PMRRR<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>PMRRR is a parallel implementation of the MRRR algorithm introduced by
<a class="reference external" href="http://www.cs.utexas.edu/~inderjit/">Inderjit Dhillon</a> and
<a class="reference external" href="http://math.berkeley.edu/~parlett/">Beresford Parlett</a> for computing
<span class="math">\(k\)</span> eigenvectors of a tridiagonal matrix of size <span class="math">\(n\)</span> in
<span class="math">\(\mathcal{O}(nk)\)</span> time. PMRRR was written by
<a class="reference external" href="http://www.aices.rwth-aachen.de/people/petschow">Matthias Petschow</a> and
<a class="reference external" href="http://www.aices.rwth-aachen.de/people/bientinesi">Paolo Bientinesi</a> and is
available at:</p>
<blockquote>
<div><a class="reference external" href="http://code.google.com/p/pmrrr">http://code.google.com/p/pmrrr</a></div></blockquote>
<p>Elemental builds a copy of PMRRR by default whenever possible: if an up-to-date
non-MKL version of LAPACK is used, then PMRRR only requires a working MPI C
compiler, otherwise, a Fortran 90 compiler is needed in order to build several
recent LAPACK functions. If these LAPACK routines cannot be made available,
then PMRRR is not built and Elemental&#8217;s eigensolvers are automatically disabled.</p>
</div>
<div class="section" id="id3">
<h3>libFLAME<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p><cite>libFLAME</cite> is an open source library made available as part of the FLAME
project. Its stated objective is to</p>
<blockquote class="epigraph">
<div>...transform the development of dense linear algebra libraries from an art
reserved for experts to a science that can be understood by novice and
expert alike.</div></blockquote>
<p>Elemental&#8217;s current implementation of parallel SVD is dependent upon a serial
kernel for the bidiagonal SVD. A high-performance implementation of this
kernel was recently introduced in
&#8220;Restructuring the QR Algorithm for Performance&#8221;, by Field G. van Zee, Robert
A. van de Geijn, and Gregorio Quintana-Orti. It can be found at</p>
<blockquote>
<div><a class="reference external" href="http://www.cs.utexas.edu/users/flame/pubs/RestructuredQRTOMS.pdf">http://www.cs.utexas.edu/users/flame/pubs/RestructuredQRTOMS.pdf</a></div></blockquote>
<p>Installation of <cite>libFLAME</cite> is fairly straightforward. It is recommended that
you download the latest nightly snapshot from</p>
<blockquote>
<div><a class="reference external" href="http://www.cs.utexas.edu/users/flame/snapshots/">http://www.cs.utexas.edu/users/flame/snapshots/</a></div></blockquote>
<p>and then installation should simply be a matter of running:</p>
<div class="highlight-python"><pre>./configure
make
make install</pre>
</div>
</div>
</div>
<div class="section" id="getting-elemental-s-source">
<h2>Getting Elemental&#8217;s source<a class="headerlink" href="#getting-elemental-s-source" title="Permalink to this headline">¶</a></h2>
<p>There are two basic approaches:</p>
<ol class="arabic">
<li><p class="first">Download a tarball of the most recent version from
<a class="reference external" href="http://libelemental.org/releases/">libelemental.org/releases</a>.
A new version is typically released every one to two months.</p>
</li>
<li><p class="first">Install <a class="reference external" href="http://git-scm.com/">git</a> and check out a copy of
the repository by running</p>
<div class="highlight-python"><pre>git clone git://github.com/elemental/Elemental.git</pre>
</div>
</li>
</ol>
</div>
<div class="section" id="building-elemental">
<h2>Building Elemental<a class="headerlink" href="#building-elemental" title="Permalink to this headline">¶</a></h2>
<p>On *nix machines with <a class="reference external" href="http://www.netlib.org/blas/">BLAS</a>,
<a class="reference external" href="http://www.netlib.org/lapack/">LAPACK</a>, and
<a class="reference external" href="http://en.wikipedia.org/wiki/Message_Passing_Interface">MPI</a> installed in
standard locations, building Elemental can be as simple as:</p>
<div class="highlight-python"><pre>cd elemental
mkdir build
cd build
cmake ..
make
make install</pre>
</div>
<p>As with the installation of CMake, the default install location is
system-wide, e.g., <tt class="docutils literal"><span class="pre">/usr/local</span></tt>. The installation directory can be changed
at any time by running:</p>
<div class="highlight-python"><pre>cmake -D CMAKE_INSTALL_PREFIX=/your/desired/install/path ..
make install</pre>
</div>
<p>Though the above instructions will work on many systems, it is common to need
to manually specify several build options, especially when multiple versions of
libraries or several different compilers are available on your system. For
instance, any C++, C, or Fortran compiler can respectively be set with the
<tt class="docutils literal"><span class="pre">CMAKE_CXX_COMPILER</span></tt>, <tt class="docutils literal"><span class="pre">CMAKE_C_COMPILER</span></tt>, and <tt class="docutils literal"><span class="pre">CMAKE_Fortran_COMPILER</span></tt>
variables, e.g.,</p>
<div class="highlight-python"><pre>cmake -D CMAKE_CXX_COMPILER=/usr/bin/g++ \
      -D CMAKE_C_COMPILER=/usr/bin/gcc   \
      -D CMAKE_Fortran_COMPILER=/usr/bin/gfortran ..</pre>
</div>
<p>It is also common to need to specify which libraries need to be linked in order
to provide serial BLAS and LAPACK routines (and, if SVD is important, libFLAME).
The <tt class="docutils literal"><span class="pre">MATH_LIBS</span></tt> variable was introduced for this purpose and an example
usage for configuring with BLAS and LAPACK libraries in <tt class="docutils literal"><span class="pre">/usr/lib</span></tt> would be</p>
<div class="highlight-python"><pre>cmake -D MATH_LIBS="-L/usr/lib -llapack -lblas -lm" ..</pre>
</div>
<p>It is important to ensure that if library A depends upon library B, A should
be specified to the left of B; in this case, LAPACK depends upon BLAS, so
<tt class="docutils literal"><span class="pre">-llapack</span></tt> is specified to the left of <tt class="docutils literal"><span class="pre">-lblas</span></tt>.</p>
<p>If <a class="reference external" href="http://www.cs.utexas.edu/users/flame/">libFLAME</a> is
available at <tt class="docutils literal"><span class="pre">/path/to/libflame.a</span></tt>, then the above link line should be changed
to</p>
<div class="highlight-python"><pre>cmake -D MATH_LIBS="/path/to/libflame.a;-L/usr/lib -llapack -lblas -lm" ..</pre>
</div>
<p>Elemental&#8217;s performance in Singular Value Decompositions (SVD&#8217;s) is
greatly improved on many architectures when libFLAME is linked.</p>
<div class="section" id="build-modes">
<h3>Build Modes<a class="headerlink" href="#build-modes" title="Permalink to this headline">¶</a></h3>
<p>Elemental currently has four different build modes:</p>
<ul class="simple">
<li><strong>PureDebug</strong> - An MPI-only build that maintains a call stack and provides
more error checking.</li>
<li><strong>PureRelease</strong> - An optimized MPI-only build suitable for production use.</li>
<li><strong>HybridDebug</strong> - An MPI+OpenMP build that maintains a call stack and provides
more error checking.</li>
<li><strong>HybridRelease</strong> - An optimized MPI+OpenMP build suitable for production use.</li>
</ul>
<p>The build mode can be specified with the <tt class="docutils literal"><span class="pre">CMAKE_BUILD_TYPE</span></tt> option, e.g.,
<tt class="docutils literal"><span class="pre">-D</span> <span class="pre">CMAKE_BUILD_TYPE=PureDebug</span></tt>. If this option is not specified, Elemental
defaults to the <strong>PureRelease</strong> build mode.</p>
</div>
</div>
<div class="section" id="testing-the-installation">
<h2>Testing the installation<a class="headerlink" href="#testing-the-installation" title="Permalink to this headline">¶</a></h2>
<p>Once Elemental has been installed, it is a good idea to verify that it is
functioning properly. An example of generating a random distributed matrix,
computing its Singular Value Decomposition (SVD), and checking for numerical
error is available in <a class="reference external" href="https://github.com/elemental/Elemental/blob/master/examples/lapack-like/SVD.cpp">examples/lapack-like/SVD.cpp</a>.</p>
<p>As you can see, the only required header is <tt class="docutils literal"><span class="pre">elemental.hpp</span></tt>, which must be
in the include path when compiling this simple driver, <tt class="docutils literal"><span class="pre">SVD.cpp</span></tt>.
If Elemental was installed in <tt class="docutils literal"><span class="pre">/usr/local</span></tt>, then
<tt class="docutils literal"><span class="pre">/usr/local/conf/elemvariables</span></tt> can be used to build a simple Makefile:</p>
<div class="highlight-python"><pre>include /usr/local/conf/elemvariables

SVD: SVD.cpp
    ${CXX} ${ELEM_COMPILE_FLAGS} $&lt; -o $@ ${ELEM_LINK_FLAGS} ${ELEM_LIBS}</pre>
</div>
<p>As long as <tt class="docutils literal"><span class="pre">SVD.cpp</span></tt> and this <tt class="docutils literal"><span class="pre">Makefile</span></tt> are in the current directory,
simply typing <tt class="docutils literal"><span class="pre">make</span></tt> should build the driver.</p>
<p>The executable can then typically be run with a single process (generating a
<span class="math">\(300 \times 300\)</span> distributed matrix, using</p>
<div class="highlight-python"><pre>./SVD --height 300 --width 300</pre>
</div>
<p>and the output should be similar to</p>
<div class="highlight-python"><pre>||A||_max   = 0.999997
||A||_1     = 165.286
||A||_oo    = 164.116
||A||_F     = 173.012
||A||_2     = 19.7823

||A - U Sigma V^H||_max = 2.20202e-14
||A - U Sigma V^H||_1   = 1.187e-12
||A - U Sigma V^H||_oo  = 1.17365e-12
||A - U Sigma V^H||_F   = 1.10577e-12
||A - U Sigma V_H||_F / (max(m,n) eps ||A||_2) = 1.67825</pre>
</div>
<p>The driver can be run with several processes using the MPI launcher provided
by your MPI implementation; a typical way to run the <tt class="docutils literal"><span class="pre">SVD</span></tt> driver on
eight processes would be:</p>
<div class="highlight-python"><pre>mpirun -np 8 ./SVD --height 300 --width 300</pre>
</div>
<p>You can also build a wide variety of example and test drivers
(unfortunately the line is a little blurred) by using the CMake options:</p>
<div class="highlight-python"><pre>-D ELEM_EXAMPLES=ON</pre>
</div>
<p>and/or</p>
<div class="highlight-python"><pre>-D ELEM_TESTS=ON</pre>
</div>
</div>
<div class="section" id="elemental-as-a-subproject">
<h2>Elemental as a subproject<a class="headerlink" href="#elemental-as-a-subproject" title="Permalink to this headline">¶</a></h2>
<p>Adding Elemental as a dependency into a project which uses CMake for its build
system is relatively straightforward: simply put an entire copy of the
Elemental source tree in a subdirectory of your main project folder, say
<tt class="docutils literal"><span class="pre">external/elemental</span></tt>, and then create a <tt class="docutils literal"><span class="pre">CMakeLists.txt</span></tt> file in your main
project folder that builds off of the following snippet:</p>
<div class="highlight-python"><pre>cmake_minimum_required(VERSION 2.8.5)
project(Foo)

add_subdirectory(external/elemental)
include_directories("${PROJECT_BINARY_DIR}/external/elemental/include")
include_directories(${MPI_CXX_INCLUDE_PATH})

# Build your project here
# e.g.,
#   add_library(foo ${LIBRARY_TYPE} ${FOO_SRC})
#   target_link_libraries(foo elemental)</pre>
</div>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<p>If you run into build problems, please email
<a class="reference external" href="mailto:elemental-maint&#37;&#52;&#48;googlegroups&#46;com">elemental-maint<span>&#64;</span>googlegroups<span>&#46;</span>com</a>
and make sure to attach the file <tt class="docutils literal"><span class="pre">include/elemental/config.h</span></tt>, which should
be generated within your build directory.
Please only direct usage questions to
<a class="reference external" href="mailto:elemental-user&#37;&#52;&#48;googlegroups&#46;com">elemental-user<span>&#64;</span>googlegroups<span>&#46;</span>com</a>,
and development questions to
<a class="reference external" href="mailto:elemental-dev&#37;&#52;&#48;googlegroups&#46;com">elemental-dev<span>&#64;</span>googlegroups<span>&#46;</span>com</a>.</p>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="intro.html">Introduction</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="core.html">Core functionality</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2009-2013, Jack Poulson.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>